version: '{build}'

branches:
  only:
  - AppVeyor


install:
  - cinst cmake
#  - cinst mysql
  - cinst jom

before_build:
  - set
  - call "C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" x86
  - set PATH=C:\ProgramData\chocolatey\bin;%PATH%
# chocolatey broke jom, here's workaround (see https://github.com/jcfr/qt-easy-build/commit/6366f4275562bdaf4f686838600f46894579c41e)
  - dir C:\ProgramData\chocolatey\lib\jom\content
  - set PATH=C:\ProgramData\chocolatey\lib\jom\content;%PATH%
  - path

build_script:
  - mkdir install
  - build_cmake.cmd "-DCMAKE_INSTALL_PREFIX=%CD%\install"
  - set PATH=%CD%\install\bin;%PATH%

test_script:
  - build/script/runtests2
