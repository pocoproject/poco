#! /bin/sh
#
# $Id: //poco/1.4/build/script/cpp11-gcc#1 $
#
# cpp11-gcc
#
# Detect compatible GCC version and add c++11/14 flags
#

GCCVERSION := $(shell gcc --version | grep ^gcc | sed 's/^.* //g')

GCC_MAJOR_VER_GTE_5 := $(shell expr `echo $(GCCVERSION) | cut -f1 -d.` \>= 5)
GCC_MAJOR_VER_GTE_4 := $(shell expr `echo $(GCCVERSION) | cut -f1 -d.` \>= 4)
GCC_MINOR_VER_GTE_10 := $(shell expr `echo $(GCCVERSION) | cut -f2 -d.` \>= 10)
GCC_MINOR_VER_GTE_9 := $(shell expr `echo $(GCCVERSION) | cut -f2 -d.` \>= 9)
GCC_MINOR_VER_GTE_8 := $(shell expr `echo $(GCCVERSION) | cut -f2 -d.` \>= 8)
GCC_PATCH_VER_GTE_2 := $(shell expr `echo $(GCCVERSION) | cut -f3 -d.` \>= 2)
GCC_PATCH_VER_GTE_1 := $(shell expr `echo $(GCCVERSION) | cut -f3 -d.` \>= 1)

ifeq "$(GCC_MAJOR_VER_GTE_5)" "1"
	CXXFLAGS += -std=c++14
else ifeq "$(GCC_MAJOR_VER_GTE_4)" "1"
    ifeq "$(GCC_MINOR_VER_GTE_10)" "1"
	CXXFLAGS += -std=c++14
    # C++14 needs GCC 4.9.2
    else ifeq "$(GCC_MINOR_VER_GTE_9)" "1"
	ifeq "$(GCC_PATCH_VER_GTE_2)" "1"
        	CXXFLAGS += -std=c++14
	endif
    # C++11 needs GCC 4.8.1
    else ifeq "$(GCC_MINOR_VER_GTE_8)" "1"
	ifeq "$(GCC_PATCH_VER_GTE_1)" "1"
        	CXXFLAGS += -std=c++11
	endif
    endif
endif

