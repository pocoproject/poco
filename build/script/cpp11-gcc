#! /bin/sh
#
# $Id: //poco/1.4/build/script/cpp11-gcc#1 $
#
# cpp11-gcc
#
# Detect compatible GXX version and add c++11/14 flags
#

GXXVERSION := $(shell g++ --version | grep ^g++ | sed 's/^.* //g')

GXX_MAJOR_VER_GTE_5 := $(shell expr `echo $(GXXVERSION) | cut -f1 -d.` \>= 5)
GXX_MAJOR_VER_GTE_4 := $(shell expr `echo $(GXXVERSION) | cut -f1 -d.` \>= 4)
GXX_MINOR_VER_GTE_10 := $(shell expr `echo $(GXXVERSION) | cut -f2 -d.` \>= 10)
GXX_MINOR_VER_GTE_9 := $(shell expr `echo $(GXXVERSION) | cut -f2 -d.` \>= 9)
GXX_MINOR_VER_GTE_8 := $(shell expr `echo $(GXXVERSION) | cut -f2 -d.` \>= 8)
GXX_PATCH_VER_GTE_2 := $(shell expr `echo $(GXXVERSION) | cut -f3 -d.` \>= 2)
GXX_PATCH_VER_GTE_1 := $(shell expr `echo $(GXXVERSION) | cut -f3 -d.` \>= 1)

ifeq "$(GXX_MAJOR_VER_GTE_5)" "1"
	CXXFLAGS += -std=c++14
else ifeq "$(GXX_MAJOR_VER_GTE_4)" "1"
    ifeq "$(GXX_MINOR_VER_GTE_10)" "1"
	CXXFLAGS += -std=c++14
    # C++14 needs GXX 4.9.2
    else ifeq "$(GXX_MINOR_VER_GTE_9)" "1"
	ifeq "$(GXX_PATCH_VER_GTE_2)" "1"
        	CXXFLAGS += -std=c++14
	endif
    # C++11 needs GXX 4.8.1
    else ifeq "$(GXX_MINOR_VER_GTE_8)" "1"
	ifeq "$(GXX_PATCH_VER_GTE_1)" "1"
        	CXXFLAGS += -std=c++11
	endif
    endif
endif

