#! /bin/sh
#
# $Id: //poco/1.4/build/script/cpp11-clang#1 $
#
# cpp11-clang
#
# Detect compatible Clang version and add c++11/14 flags
#

CLANGMAJOR   := $(shell $(CXX) -E -dM - < /dev/null | grep __clang_major__ | sed -e 's/^.* //g'i)
CLANGMINOR   := $(shell $(CXX) -E -dM - < /dev/null | grep __clang_minor__ | sed -e 's/^.* //g'i)
CLANGPATCH   := $(shell $(CXX) -E -dM - < /dev/null | grep __clang_patchlevel__ | sed -e 's/^.* //g'i)
CLANGVERSION := $(CLANGMAJOR)$(CLANGMINOR)$(CLANGPATCH)
# C++14 needs Clang 3.4
ifeq ($(shell test $(CLANGVERSION) -gt 339 && echo 1), 1)
	CXXFLAGS += -std=c++1y
# C++11 needs Clang 3.3
else ifeq ($(shell test $(CLANGVERSION) -gt 329 && echo 1), 1)
#	CXXFLAGS += -std=c++0x
endif
